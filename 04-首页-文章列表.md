# å››ã€é¦–é¡µâ€”æ–‡ç« åˆ—è¡¨

<img src="./assets/1566539328996.png" width="250">

## é¡µé¢å¸ƒå±€

<img src="assets/image-20200311014026734.png" alt="image-20200311014026734" style="zoom:50%;" />

```html
<template>
  <div class="home-container">
    <van-nav-bar class="page-nav-bar">
      <div slot="left" class="logo"></div>
      <van-button
        slot="right"
        class="search-btn"
        icon="search"
        type="default"
        size="small"
        round
      >æœç´¢</van-button>
    </van-nav-bar>
  </div>
</template>

<script>
export default {
  name: 'HomePage',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.page-nav-bar {
  .logo {
    background: url("./logo.png") no-repeat;
    width: 220px;
    height: 80px;
    background-size: contain;
  }
  .search-btn {
    background-color: #5babfb;
    border: none;
    width: 300px;
    color: #fff;
    .van-icon {
      color: #fff;
    }
  }
}
</style>

```



## å±•ç¤ºæ–‡ç« é¢‘é“åˆ—è¡¨

<img src="assets/image-20200305195458197.png" alt="image-20200305195458197" style="zoom: 80%;" />

å¤„ç†æµç¨‹ï¼š

- ä½¿ç”¨ Tab æ ‡ç­¾é¡µç»„ä»¶å¸ƒå±€
- å°è£…è¯·æ±‚
- è¯·æ±‚è·å–æ•°æ®
- æ¨¡æ¿ç»‘å®š
- ç»†èŠ‚å¤„ç†

1ã€å°è£…è¯·æ±‚æ¥å£

```js
/**
 * é¢‘é“è¯·æ±‚æ¨¡å—
 */
import request from '@/utils/request'

/**
 * è·å–é¢‘é“åˆ—è¡¨
 */
export const getChannels = () => {
  return request({
    method: 'GET',
    url: '/app/v1_0/user/channels'
  })
}

```

2ã€åœ¨é¦–é¡µä¸­è¯·æ±‚åŠ è½½ï¼Œç»‘å®šæ¨¡æ¿

```html
<template>
  <div class="home-container">
    <!-- å¯¼èˆªæ  -->
    <van-nav-bar class="page-nav-bar">
      <div slot="left" class="logo"></div>
      <van-button
        slot="right"
        class="search-btn"
        icon="search"
        type="info"
        size="small"
        round
      >æœç´¢</van-button>
    </van-nav-bar>
    <!-- /å¯¼èˆªæ  -->

    <!-- æ–‡ç« é¢‘é“åˆ—è¡¨ -->
    <van-tabs v-model="active">
      <van-tab
        :title="channel.name"
        v-for="channel in channels"
        :key="channel.id"
				swipeable
				animated
      >{{ channel.name }} çš„å†…å®¹</van-tab>
    </van-tabs>
    <!-- /æ–‡ç« é¢‘é“åˆ—è¡¨ -->
  </div>
</template>

<script>
import { getChannels } from '@/api/channel'

export default {
  name: 'HomePage',
  components: {},
  props: {},
  data () {
    return {
      active: 0, // æ§åˆ¶è¢«æ¿€æ´»çš„æ ‡ç­¾é¡µ
      channels: [] // é¢‘é“åˆ—è¡¨
    }
  },
  computed: {},
  watch: {},
  created () {
    this.loadChannels()
  },
  mounted () {},
  methods: {
    async loadChannels () {
      try {
        const { data } = await getChannels()
        this.channels = data.data.channels
      } catch (err) {
        console.log(err)
        this.$toast('æ•°æ®è·å–å¤±è´¥')
      }
    }
  }
}
</script>

<style scoped lang="less">
.page-nav-bar {
  .logo {
    width: 220px;
    height: 80px;
    background: url("./logo.png") no-repeat;
    background-size: contain;
  }
  .search-btn {
    background-color: #5babfb;
    width: 300px;
    border: none;
    .van-icon {
      color: #fff;
    }
  }
}
</style>

```



## å±•ç¤ºæ–‡ç« åˆ—è¡¨

<img src="assets/image-20200311221143472.png" alt="image-20200311221143472" style="zoom: 50%;" />

### æ€è·¯åˆ†æ

æ ¹æ®ä¸åŒçš„é¢‘é“åŠ è½½ä¸åŒçš„æ–‡ç« åˆ—è¡¨ï¼Œä½ çš„æ€è·¯å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

- æœ‰ä¸€ä¸ª `list` æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨æ–‡ç« åˆ—è¡¨
- æŸ¥çœ‹ `a` é¢‘é“ï¼šè¯·æ±‚è·å–æ•°æ®ï¼Œè®© `list = a` é¢‘é“æ–‡ç« 
- æŸ¥çœ‹ `b` é¢‘é“ï¼šè¯·æ±‚è·å–æ•°æ®ï¼Œè®© `list = b` é¢‘é“æ–‡ç« 
- æŸ¥çœ‹ `c` é¢‘é“ï¼šè¯·æ±‚è·å–æ•°æ®ï¼Œè®© `list = c` é¢‘é“æ–‡ç« 
- ...

![image-20200111124415227](assets/image-20200111124415227.png)

æ€è·¯æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚

æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯ï¼š**åŠ è½½è¿‡çš„æ•°æ®åˆ—è¡¨ä¸è¦é‡æ–°åŠ è½½**ã€‚



å®ç°æ€è·¯ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬å‡†å¤‡**å¤šä¸ª list æ•°ç»„ï¼Œæ¯ä¸ªé¢‘é“å¯¹åº”ä¸€ä¸ªï¼ŒæŸ¥çœ‹å“ªä¸ªé¢‘é“å°±æŠŠæ•°æ®å¾€å“ªä¸ªé¢‘é“çš„åˆ—è¡¨æ•°ç»„ä¸­å­˜æ”¾ï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šå¯¼è‡´è¦†ç›–é—®é¢˜**ã€‚

![image-20200111124530323](assets/image-20200111124530323.png)



å¯æ˜¯æœ‰å¤šå°‘é¢‘é“å°±å¾—æœ‰å¤šå°‘é¢‘é“æ–‡ç« æ•°ç»„ï¼Œæˆ‘ä»¬éƒ½ä¸€ä¸ªä¸€ä¸ªå£°æ˜çš„è¯ä¼šéå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥è¿™é‡Œçš„å»ºè®®æ˜¯åˆ©ç”¨ç»„ä»¶æ¥å¤„ç†ã€‚

å…·ä½“åšæ³•å°±æ˜¯ï¼š

- å°è£…ä¸€ä¸ªæ–‡ç« åˆ—è¡¨ç»„ä»¶
- ç„¶ååœ¨é¢‘é“åˆ—è¡¨ä¸­æŠŠæ–‡ç« åˆ—è¡¨éå†å‡ºæ¥

**å› ä¸ºæ–‡ç« åˆ—è¡¨ç»„ä»¶ä¸­è¯·æ±‚è·å–æ–‡ç« åˆ—è¡¨æ•°æ®éœ€è¦é¢‘é“ idï¼Œæ‰€ä»¥ é¢‘é“ id åº”è¯¥ä½œä¸º props å‚æ•°ä¼ é€’ç»™æ–‡ç« åˆ—è¡¨ç»„ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠé¢‘é“å¯¹è±¡ä¼ é€’ç»™æ–‡ç« åˆ—è¡¨ç»„ä»¶å°±å¯ä»¥äº†ã€‚**

<img src="assets/image-20200306155328108.png" alt="image-20200306155328108" style="zoom: 67%;" />

åœ¨æ–‡ç« åˆ—è¡¨ä¸­è¯·æ±‚è·å–å¯¹åº”çš„åˆ—è¡¨æ•°æ®ï¼Œå±•ç¤ºåˆ°åˆ—è¡¨ä¸­ã€‚

æœ€åæŠŠç»„ä»¶åœ¨é¢‘é“åˆ—è¡¨ä¸­éå†å‡ºæ¥ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

![image-20200306154805522](assets/image-20200306154805522.png)



1ã€åˆ›å»º `src/views/home/components/article-list.vue`

```html
<template>
  <div class="article-list">æ–‡ç« åˆ—è¡¨</div>
</template>

<script>
export default {
  name: 'ArticleList',
  components: {},
  props: {
    channel: {
      type: Object,
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```



2ã€åœ¨ `home/index.vue` ä¸­æ³¨å†Œä½¿ç”¨

<img src="assets/image-20200305205441485.png" alt="image-20200305205441485" style="zoom:50%;" />



3ã€æœ€åæµ‹è¯•ã€‚



ç­”ç–‘ï¼š

- ä¸ºä»€ä¹ˆæ ‡ç­¾å†…å®¹æ˜¯æ‡’æ¸²æŸ“çš„ï¼Ÿ
  - å› ä¸ºè¿™æ˜¯ Tab æ ‡ç­¾é¡µç»„ä»¶æœ¬èº«æ”¯æŒçš„é»˜è®¤åŠŸèƒ½ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥é€šè¿‡é…ç½® `:lazy-render="false"` æ¥å…³é—­è¿™ä¸ªæ•ˆæœã€‚

### ä½¿ç”¨ List åˆ—è¡¨ç»„ä»¶

Vant ä¸­æä¾›çš„ [List åˆ—è¡¨](https://youzan.github.io/vant/#/zh-CN/list) ç»„ä»¶æ”¯æŒä¸Šæ‹‰åŠ è½½æ›´å¤šåŠŸèƒ½ã€‚

List ç»„ä»¶é€šè¿‡`loading`å’Œ`finished`ä¸¤ä¸ªå˜é‡æ§åˆ¶åŠ è½½çŠ¶æ€ï¼Œå½“ç»„ä»¶æ»šåŠ¨åˆ°åº•éƒ¨æ—¶ï¼Œä¼šè§¦å‘`load`äº‹ä»¶å¹¶å°†`loading`è®¾ç½®æˆ`true`ã€‚æ­¤æ—¶å¯ä»¥å‘èµ·å¼‚æ­¥æ“ä½œå¹¶æ›´æ–°æ•°æ®ï¼Œæ•°æ®æ›´æ–°å®Œæ¯•åï¼Œå°†`loading`è®¾ç½®æˆ`false`å³å¯ã€‚è‹¥æ•°æ®å·²å…¨éƒ¨åŠ è½½å®Œæ¯•ï¼Œåˆ™ç›´æ¥å°†`finished`è®¾ç½®æˆ`true`å³å¯ã€‚

- loading
- finished
- load äº‹ä»¶

List åˆå§‹åŒ–åä¼šè§¦å‘ä¸€æ¬¡ load äº‹ä»¶ï¼Œç”¨äºåŠ è½½ç¬¬ä¸€å±çš„æ•°æ®ï¼Œä¹‹åä¼šç›‘å¬æµè§ˆå™¨çš„æ»šåŠ¨äº‹ä»¶å¹¶è®¡ç®—åˆ—è¡¨çš„ä½ç½®ï¼Œå½“åˆ—è¡¨å¿«è¦è§¦åº•æ—¶ï¼ŒList ä¼šå†æ¬¡è§¦å‘ load äº‹ä»¶ã€‚

å¦‚æœä¸€æ¬¡è¯·æ±‚åŠ è½½çš„æ•°æ®æ¡æ•°è¾ƒå°‘ï¼Œå¯¼è‡´åˆ—è¡¨å†…å®¹æ— æ³•é“ºæ»¡å½“å‰å±å¹•ï¼ŒList ä¼šç»§ç»­è§¦å‘ load äº‹ä»¶ï¼Œç›´åˆ°å†…å®¹é“ºæ»¡å±å¹•æˆ–æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆã€‚



**List çš„è¿è¡Œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ**

> List ä¼šç›‘å¬æµè§ˆå™¨çš„æ»šåŠ¨äº‹ä»¶å¹¶è®¡ç®—åˆ—è¡¨çš„ä½ç½®ï¼Œå½“åˆ—è¡¨åº•éƒ¨ä¸å¯è§†åŒºåŸŸçš„è·ç¦»å°äºoffsetæ—¶ï¼ŒList ä¼šè§¦å‘ä¸€æ¬¡ load äº‹ä»¶ã€‚



**ä¸ºä»€ä¹ˆ List åˆå§‹åŒ–åä¼šç«‹å³è§¦å‘ load äº‹ä»¶ï¼Ÿ**

> List åˆå§‹åŒ–åä¼šè§¦å‘ä¸€æ¬¡ load äº‹ä»¶ï¼Œç”¨äºåŠ è½½ç¬¬ä¸€å±çš„æ•°æ®ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥é€šè¿‡immediate-checkå±æ€§å…³é—­ã€‚



**ä¸ºä»€ä¹ˆä¼šè¿ç»­è§¦å‘ load äº‹ä»¶ï¼Ÿ**

> å¦‚æœä¸€æ¬¡è¯·æ±‚åŠ è½½çš„æ•°æ®æ¡æ•°è¾ƒå°‘ï¼Œå¯¼è‡´åˆ—è¡¨å†…å®¹æ— æ³•é“ºæ»¡å½“å‰å±å¹•ï¼ŒList ä¼šç»§ç»­è§¦å‘ load äº‹ä»¶ï¼Œç›´åˆ°å†…å®¹é“ºæ»¡å±å¹•æˆ–æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆã€‚å› æ­¤ä½ éœ€è¦è°ƒæ•´æ¯æ¬¡è·å–çš„æ•°æ®æ¡æ•°ï¼Œç†æƒ³æƒ…å†µä¸‹æ¯æ¬¡è¯·æ±‚è·å–çš„æ•°æ®æ¡æ•°åº”èƒ½å¤Ÿå¡«æ»¡ä¸€å±é«˜åº¦ã€‚



**loading å’Œ finished åˆ†åˆ«æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ**

> Listæœ‰ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ï¼Œç†è§£è¿™äº›çŠ¶æ€æœ‰åŠ©äºä½ æ­£ç¡®åœ°ä½¿ç”¨Listç»„ä»¶ï¼š
>
> - éåŠ è½½ä¸­ï¼Œloadingä¸ºfalseï¼Œæ­¤æ—¶ä¼šæ ¹æ®åˆ—è¡¨æ»šåŠ¨ä½ç½®åˆ¤æ–­æ˜¯å¦è§¦å‘loadäº‹ä»¶ï¼ˆåˆ—è¡¨å†…å®¹ä¸è¶³ä¸€å±å¹•æ—¶ï¼Œä¼šç›´æ¥è§¦å‘ï¼‰
> - åŠ è½½ä¸­ï¼Œloadingä¸ºtrueï¼Œè¡¨ç¤ºæ­£åœ¨å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œæ­¤æ—¶ä¸ä¼šè§¦å‘loadäº‹ä»¶
> - åŠ è½½å®Œæˆï¼Œfinishedä¸ºtrueï¼Œæ­¤æ—¶ä¸ä¼šè§¦å‘loadäº‹ä»¶
>
> åœ¨æ¯æ¬¡è¯·æ±‚å®Œæ¯•åï¼Œéœ€è¦æ‰‹åŠ¨å°†loadingè®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºåŠ è½½ç»“æŸ



**ä½¿ç”¨ float å¸ƒå±€åä¸€ç›´è§¦å‘åŠ è½½ï¼Ÿ**

> è‹¥ List çš„å†…å®¹ä½¿ç”¨äº† float å¸ƒå±€ï¼Œå¯ä»¥åœ¨å®¹å™¨ä¸Šæ·»åŠ van-clearfixç±»åæ¥æ¸…é™¤æµ®åŠ¨ï¼Œä½¿å¾— List èƒ½æ­£ç¡®åˆ¤æ–­å…ƒç´ ä½ç½®
>
> ```html
> <van-list>
>   <div class="van-clearfix">
>     <div class="float-item" />
>     <div class="float-item" />
>     <div class="float-item" />
>   </div>
> </van-list>
> ```



### åŠ è½½æ–‡ç« åˆ—è¡¨æ•°æ®

å®ç°æ€è·¯ï¼š

- æ‰¾æ¥å£
- å°è£…è¯·æ±‚æ–¹æ³•
- è¯·æ±‚åŠ è½½
- æ¨¡æ¿ç»‘å®š



1ã€åˆ›å»º `src/api/article.js` å°è£…è·å–æ–‡ç« åˆ—è¡¨æ•°æ®çš„æ¥å£

```js
/**
 * æ–‡ç« æ¥å£æ¨¡å—
 */
import request from '@/utils/request'

/**
 * è·å–é¢‘é“çš„æ–‡ç« åˆ—è¡¨
 */
export const getArticles = params => {
  return request({
    method: 'GET',
    url: '/app/v1_1/articles',
    params
  })
}
```

> æ³¨æ„ï¼šä½¿ç”¨æ¥å£æ–‡æ¡£ä¸­æœ€ä¸‹é¢çš„ **é¢‘é“æ–°é—»æ¨è\_V1.1**

2ã€ç„¶ååœ¨é¦–é¡µæ–‡ç« åˆ—è¡¨ç»„ä»¶ `onload` çš„æ—¶å€™è¯·æ±‚åŠ è½½æ–‡ç« åˆ—è¡¨

```html
<template>
  <div class="article-list">
      <!--
        loading æ§åˆ¶ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„ loading çŠ¶æ€
        finished æ§åˆ¶æ•°æ®æ˜¯å¦åŠ è½½ç»“æŸ
        load äº‹ä»¶ï¼šå½“è§¦å‘ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ—¶å€™ä¼šè§¦å‘è°ƒç”¨ load äº‹ä»¶

        List åˆå§‹åŒ–åä¼šè§¦å‘ä¸€æ¬¡ load äº‹ä»¶ï¼Œç”¨äºåŠ è½½ç¬¬ä¸€å±çš„æ•°æ®
        å¦‚æœä¸€æ¬¡è¯·æ±‚åŠ è½½çš„æ•°æ®æ¡æ•°è¾ƒå°‘ï¼Œå¯¼è‡´åˆ—è¡¨å†…å®¹æ— æ³•é“ºæ»¡å½“å‰å±å¹•ï¼ŒList ä¼šç»§ç»­è§¦å‘ load äº‹ä»¶ï¼Œç›´åˆ°å†…å®¹é“ºæ»¡å±å¹•æˆ–æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆ
      -->
      <van-list
        v-model="loading"
        :finished="finished"
        finished-text="æ²¡æœ‰æ›´å¤šäº†"
        :error.sync="error"
        error-text="è¯·æ±‚å¤±è´¥ï¼Œç‚¹å‡»é‡æ–°åŠ è½½"
        @load="onLoad"
      >
        <van-cell
          v-for="(article, index) in list"
          :key="index"
          :title="article.title"
        />
      </van-list>
  </div>
</template>

<script>
import { getArticles } from '@/api/article'

export default {
  name: 'ArticleList',
  components: {},
  props: {
    channel: {
      type: Object,
      required: true
    }
  },
  data () {
    return {
      list: [], // æ–‡ç« åˆ—è¡¨æ•°æ®
      loading: false, // ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„ loading çŠ¶æ€
      finished: false, // æ˜¯å¦åŠ è½½ç»“æŸ
      error: false, // æ˜¯å¦åŠ è½½å¤±è´¥
      timestamp: null // è¯·æ±‚ä¸‹ä¸€é¡µæ•°æ®çš„æ—¶é—´æˆ³
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {
    // å½“è§¦å‘ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ—¶å€™è°ƒç”¨è¯¥å‡½æ•°
    async onLoad () {
      try {
        // 1. è¯·æ±‚è·å–æ•°æ®
        const { data } = await getArticles({
          channel_id: this.channel.id, // é¢‘é“ id
          timestamp: this.timestamp || Date.now(), // æ—¶é—´æˆ³ï¼Œè¯·æ±‚æ–°çš„æ¨èæ•°æ®ä¼ å½“å‰çš„æ—¶é—´æˆ³ï¼Œè¯·æ±‚å†å²æ¨èä¼ æŒ‡å®šçš„æ—¶é—´æˆ³
          with_top: 1 // æ˜¯å¦åŒ…å«ç½®é¡¶ï¼Œè¿›å…¥é¡µé¢ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶è¦åŒ…å«ç½®é¡¶æ–‡ç« ï¼Œ1-åŒ…å«ç½®é¡¶ï¼Œ0-ä¸åŒ…å«
        })

        // 2. æŠŠæ•°æ®æ·»åŠ åˆ° list æ•°ç»„ä¸­
        const { results } = data.data
        this.list.push(...results)

        // 3. è®¾ç½®æœ¬æ¬¡åŠ è½½ä¸­ loading çŠ¶æ€ç»“æŸ
        this.loading = false

        // 4. åˆ¤æ–­æ•°æ®æ˜¯å¦åŠ è½½ç»“æŸ
        if (results.length) {
          // æ›´æ–°è·å–ä¸‹ä¸€é¡µæ•°æ®çš„æ—¶é—´æˆ³
          this.timestamp = data.data.pre_timestamp
        } else {
          // æ²¡æœ‰æ•°æ®äº†ï¼Œè®¾ç½®åŠ è½½çŠ¶æ€ç»“æŸï¼Œä¸å†è§¦å‘ä¸Šæ‹‰åŠ è½½æ›´å¤šäº†
          this.finished = true
        }
      } catch (err) {
        console.log(err)
        this.loading = false // å…³é—­ loading æ•ˆæœ
        this.error = true // å¼€å¯é”™è¯¯æç¤º
      }
    }
  }
}
</script>

<style scoped lang="less"></style>

```

æœ€åæµ‹è¯•ã€‚



### ä¸‹æ‹‰åˆ·æ–°

<img src="assets/å±•ç¤ºæ–‡ç« åˆ—è¡¨-ä¸‹æ‹‰åˆ·æ–°.gif" alt="å±•ç¤ºæ–‡ç« åˆ—è¡¨-ä¸‹æ‹‰åˆ·æ–°" width="250" />

è¿™é‡Œä¸»è¦ä½¿ç”¨åˆ° Vant ä¸­çš„ [PullRefresh ä¸‹æ‹‰åˆ·æ–°](https://youzan.github.io/vant/#/zh-CN/pull-refresh) ç»„ä»¶ã€‚

æ€è·¯ï¼š

- æ³¨å†Œä¸‹æ‹‰åˆ·æ–°äº‹ä»¶ï¼ˆç»„ä»¶ï¼‰çš„å¤„ç†å‡½æ•°
- å‘é€è¯·æ±‚è·å–æ–‡ç« åˆ—è¡¨æ•°æ®
- æŠŠè·å–åˆ°çš„æ•°æ®æ·»åŠ åˆ°å½“å‰é¢‘é“çš„æ–‡ç« åˆ—è¡¨çš„é¡¶éƒ¨
- æç¤ºç”¨æˆ·åˆ·æ–°æˆåŠŸï¼

ä¸‹æ‹‰åˆ·æ–°æ—¶ä¼šè§¦å‘ç»„ä»¶çš„ `refresh` äº‹ä»¶ï¼Œåœ¨äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­å¯ä»¥è¿›è¡ŒåŒæ­¥æˆ–å¼‚æ­¥æ“ä½œï¼Œæ“ä½œå®Œæˆåå°† `v-model` è®¾ç½®ä¸º `false`ï¼Œè¡¨ç¤ºåŠ è½½å®Œæˆã€‚

```js
// å½“è§¦å‘ä¸‹æ‹‰åˆ·æ–°çš„æ—¶å€™è°ƒç”¨è¯¥å‡½æ•°
async onRefresh () {
  try {
    // 1. è¯·æ±‚è·å–æ•°æ®
    const { data } = await getArticles({
      channel_id: this.channel.id, // é¢‘é“ id
      timestamp: Date.now(), // ä¸‹æ‹‰åˆ·æ–°æ¯æ¬¡éƒ½åº”è¯¥è·å–æœ€æ–°æ•°æ®
      with_top: 1 // æ˜¯å¦åŒ…å«ç½®é¡¶ï¼Œè¿›å…¥é¡µé¢ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶è¦åŒ…å«ç½®é¡¶æ–‡ç« ï¼Œ1-åŒ…å«ç½®é¡¶ï¼Œ0-ä¸åŒ…å«
    })

    // 2. å°†æ•°æ®è¿½åŠ åˆ°åˆ—è¡¨çš„é¡¶éƒ¨
    const { results } = data.data
    this.list.unshift(...results)

    // 3. å…³é—­ä¸‹æ‹‰åˆ·æ–°çš„ loading çŠ¶æ€
    this.isRefreshLoading = false

    // æç¤ºæˆåŠŸ
    this.refreshSuccessText = `åˆ·æ–°æˆåŠŸï¼Œæ›´æ–°äº†${results.length}æ¡æ•°æ®`
  } catch (err) {
    console.log(err)
    this.isRefreshLoading = false // å…³é—­ä¸‹æ‹‰åˆ·æ–°çš„ loading çŠ¶æ€
    this.$toast('åˆ·æ–°å¤±è´¥')
  }
}
```

## ä¼˜åŒ–æ–‡ç« åˆ—è¡¨

### å›ºå®šå¤´éƒ¨å’Œé¢‘é“åˆ—è¡¨

1ã€è®©å¤´éƒ¨å›ºå®šå®šä½

```html
<van-nav-bar fixed> ... </van-nav-bar>
```



2ã€è®©é¢‘é“åˆ—è¡¨å›ºå®šå®šä½

```less
.home-container {
  /deep/ .van-tabs__wrap {
    position: fixed;
    top: 46px;
    left: 0;
    right: 0;
    z-index: 1;
  }
}
```

> [å…³äº .vue æ–‡ä»¶ä¸­çš„ä½œç”¨åŸŸæ ·å¼](https://vue-loader.vuejs.org/zh/guide/scoped-css.html)

3ã€ç»™é¡µé¢å®¹å™¨æ·»åŠ ä¸Šä¸‹å†…è¾¹è·

```less
.home-container {
  padding-top: 180px;
  padding-bottom: 100px;
}
```



å¦‚æœæƒ³è¦åœ¨çˆ¶ç»„ä»¶ä¸­å½±å“å­ç»„ä»¶æ ·å¼ï¼š

- è¦ä¹ˆä¸è¦æœ‰ä½œç”¨åŸŸï¼Œé‚£å°±æ˜¯å…¨å±€ï¼Œå¯ä»¥å½±å“ä»»ä½•ç»„ä»¶

- å¦‚æœæœ‰ä½œç”¨åŸŸ
  - é»˜è®¤åªèƒ½å½±å“åˆ°è‡ªå­ç»„ä»¶çš„æ ¹èŠ‚ç‚¹
    - å®¡æŸ¥å…ƒç´ æ‰¾åˆ°å­ç»„ä»¶æ ¹èŠ‚ç‚¹ç±»åä½¿ç”¨
    - æˆ–è€…æ‰‹åŠ¨ç»™å­ç»„ä»¶æ·»åŠ ä¸€ä¸ª classï¼Œå®ƒä¼šè‡ªåŠ¨æ·»åŠ åˆ°å­ç»„ä»¶æ ¹èŠ‚ç‚¹çš„ class ä¸­
  - å¦‚æœéœ€è¦å½±å“çš„æ›´æ·±ï¼Œåˆ™ä½¿ç”¨æ·±åº¦ä½œç”¨é€‰æ‹©å™¨ï¼š`>>>`ã€`/deep/`ã€`::v-deep`
    - `>>>` åœ¨ lessã€sassã€stylus ç­‰ CSS é¢„å¤„ç†å™¨ä¸­ä¼šæŠ¥é”™
    - æ‰€ä»¥å»ºè®®ä½¿ç”¨ `/deep/` æˆ–è€… `::v-deep`

### è®°ä½åˆ—è¡¨çš„æ»šåŠ¨ä½ç½®

æ€è·¯ï¼š

- ç›‘å¬æ–‡ç« åˆ—è¡¨çš„æ»šåŠ¨äº‹ä»¶ï¼Œå°†å½“å‰æ»šåŠ¨çš„è·ç¦»è®°å½•èµ·æ¥
- å½“åˆ‡æ¢é¢‘é“çš„æ—¶å€™å°†ä¹‹å‰è®°å½•çš„æ»šåŠ¨è·ç¦»è®¾ç½®å›å»

ä¸€ã€è®¾ç½®æ»šåŠ¨å®¹å™¨

1ã€ç»™æ ‡ç­¾é¡µç»„ä»¶å¤–å±‚åŒ…è£¹ä¸€ä¸ªå®¹å™¨

```html
<div class="article-scroll-wrap" ref="article-scroll-wrap">
  <van-tabs>
    ...
  </van-tabs>
</div>
```

2ã€è®¾ç½®å®¹å™¨æ ·å¼

```less
.article-list-wrap {
  height: 79vh;
  overflow-y: auto;
}
```

äºŒã€ç›‘å¬æ»šåŠ¨äº‹ä»¶

1ã€å®‰è£… lodash

```shell
npm i lodash
```

2ã€åŠ è½½å‡½æ•°é˜²æŠ–å¤„ç†å‡½æ•°

```js
import { debounce } from 'lodash'
```

3ã€åœ¨ mounted ä¸­è·å–ç›‘å¬æ»šåŠ¨å®¹å™¨çš„æ»šåŠ¨äº‹ä»¶

```js
mounted () {
  // debounce å‡½æ•°é˜²æŠ–
  //    å‚æ•°1ï¼šå‡½æ•°
  //    å‚æ•°2ï¼šäº‹ä»¶ï¼Œå•ä½æ˜¯æ¯«ç§’
  //    è¿”å›å€¼ï¼šè¿”å›ç»è¿‡é˜²æŠ–å¤„ç†çš„å‡½æ•°
  const articleScrollWrap = this.$refs['article-list-wrap']
  articleScrollWrap.onscroll = debounce(() => {
		console.log('onScroll')
  }, 50)
},
```



ä¸‰ã€è®°å½•å¹¶è®¾ç½®æ»šåŠ¨ä½ç½®

1ã€åœ¨æ»šåŠ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è®°å½•æ»šåŠ¨çš„ä½ç½®

```js
mounted () {
  // debounce å‡½æ•°é˜²æŠ–
  //    å‚æ•°1ï¼šå‡½æ•°
  //    å‚æ•°2ï¼šäº‹ä»¶ï¼Œå•ä½æ˜¯æ¯«ç§’
  //    è¿”å›å€¼ï¼šè¿”å›ç»è¿‡é˜²æŠ–å¤„ç†çš„å‡½æ•°
  const articleScrollWrap = this.articleScrollWrap
  articleScrollWrap.onscroll = debounce(() => {
    this.channels[this.active].scrollTop = articleScrollWrap.scrollTop
  }, 50)
},
```

2ã€å½“æ ‡ç­¾é¡µåˆ‡æ¢çš„æ—¶å€™è®¾ç½®æ»šåŠ¨å®¹å™¨çš„æ»šåŠ¨ä½ç½®

```html
<van-tabs change="onTabChange">
  ...
</van-tabs>
```

```js
onTabChange () {
  const scrollTop = this.channels[this.active].scrollTop
  if (scrollTop) {
    this.$nextTick(() => {
      this.articleScrollWrap.scrollTop = scrollTop
    })
    // this.articleScrollWrap.scrollTop = scrollTop
  }
}
```



å››ã€å…³äº [$nextTick](https://cn.vuejs.org/v2/api/#vm-nextTick) æ–¹æ³•çš„ä½œç”¨

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div id="app">
    <h1>å…³äº $nextTick() çš„è¯´æ˜</h1>
    <p ref="p">{{ message }}</p>
    <button @click="changeMessage">æ”¹å˜ message</button>
  </div>
  <script src="./node_modules/vue/dist/vue.js"></script>
  <script>
    new Vue({
      el: '#app',
      data: {
        message: 'Hello World'
      },
      methods: {
        changeMessage () {
          // æ•°æ®é©±åŠ¨è§†å›¾ï¼šå½“æ•°æ®æ”¹å˜ä¼šå½±å“è§†å›¾æ›´æ–°
          // ä½†æ˜¯è¿™æ›´æ–°DOMè¿™ä»¶äº‹å„¿ä¸æ˜¯ç«‹å³çš„
          this.message = 'ä½ å¥½ï¼Œä¸–ç•Œ'
          
          // console.log(this.$refs.p.innerHTML)

          // å¦‚æœä½ éœ€è¦åœ¨æ•°æ®æ”¹å˜ä¹‹åç«‹å³æ“ä½œå—æ•°æ®å½±å“å½±å“çš„è§†å›¾ DOM
          // æœ€å¥½æ”¾åˆ° nextTick å‡½æ•°ä¸­æ¥æ‰§è¡Œï¼Œè¿™æ ·ç¡®ä¿æ˜¯æ²¡æœ‰é—®é¢˜çš„
          this.$nextTick(() => {
            console.log(this.$refs.p.innerHTML)
          })
        }
      }
    })
  </script>
</body>
</html>

```



## æ–‡ç« åˆ—è¡¨é¡¹

### ç»„ä»¶å°è£…

1ã€åˆ›å»ºç»„ä»¶

2ã€åŠ è½½æ³¨å†Œ

3ã€ä½¿ç”¨ç»„ä»¶

### å¸ƒå±€å¤„ç†

```html
<template>
  <van-cell class="article-item">
    <div slot="title" class="title">{{ article.title }}</div>
    <div slot="label">
      <!-- å¦‚æœæœ‰3ä¸ªå°é¢ -->
      <van-row
        v-if="article.cover.type === 3"
        gutter="5"
        class="article-cover-wrap"
      >
        <van-col
          span="8"
          v-for="(img, index) in article.cover.images"
          :key="index"
        >
          <van-image
            slot="default"
            class="article-cover"
            :src="img"
            fit="cover"
          />
        </van-col>
      </van-row>
      <div class="article-label">
        <span>{{ article.aut_name }}</span>
        <span>{{ article.comm_count }}è¯„è®º</span>
        <span>{{ article.pubdate }}</span>
      </div>
    </div>
    <!-- å¦‚æœæœ‰1ä¸ªå°é¢ -->
    <van-image
      v-if="article.cover.type === 1"
      slot="default"
      class="article-cover"
      :src="article.cover.images[0]"
      fit="cover"
    />
  </van-cell>
</template>

<script>
export default {
  name: 'ArticleItem',
  components: {},
  props: {
    article: {
      type: Object,
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.article-item {
  .title {
    font-size: 32px;
    color: #3a3a3a;
  }
  .article-label {
    span {
      margin-right: 20px;
    }
  }
  .article-cover-wrap {
    padding: 20px 0;
    .article-cover {
      width: 100%;
    }
  }
  .article-cover {
    width: 233px;
    height: 148px;
  }
}
</style>

```

### è§£å†³ç¬¬ä¸‰æ–¹å›¾ç‰‡ 403 é—®é¢˜

HTTP Refereræ˜¯[header](https://baike.baidu.com/item/header/688992)çš„ä¸€éƒ¨åˆ†ï¼Œå½“æµè§ˆå™¨å‘web[æœåŠ¡å™¨](https://baike.baidu.com/item/æœåŠ¡å™¨)å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸ŠRefererï¼Œå‘Šè¯‰æœåŠ¡å™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼ŒæœåŠ¡å™¨å› æ­¤å¯ä»¥è·å¾—ä¸€äº›ä¿¡æ¯ç”¨äºå¤„ç†ã€‚

è¿™ä¸ªå›¾ç‰‡æ˜¯é€šè¿‡åå°æŠ“å–çš„ç¬¬ä¸‰æ–¹å¹³å°çš„æ•°æ®ï¼Œç¬¬ä¸‰æ–¹å¹³å°å¯¹è¿™äº›èµ„æºè¿›è¡Œäº†ä¿æŠ¤å¤„ç†ï¼Œå®ƒä¼šåˆ¤æ–­å¦‚æœä½ è¯·æ±‚çš„åœ°å€ä¸æ˜¯æ¥è‡ªäºæˆ‘æ¥å—çš„æ¥æºç«™ç‚¹å°±è¿”å›403ã€‚

è§£å†³åŠæ³•å°±æ˜¯è®¾ç½®æµè§ˆå™¨ä¸è¦å‘é€ referrer å°±å¯ä»¥äº†ã€‚

æ¥ä¸‹é¢çš„å£°æ˜æ”¾åˆ°é¡¹ç›®ä¸­çš„ `index.html` æ–‡ä»¶ä¸­ã€‚

```html
<meta name="referrer" content="no-referrer" />
```

### å›¾ç‰‡æ‡’åŠ è½½

è®¾ç½®`lazy-load`å±æ€§æ¥å¼€å¯å›¾ç‰‡æ‡’åŠ è½½ï¼Œéœ€è¦æ­é… [Lazyload](https://youzan.github.io/vant/#/zh-CN/lazyload) ç»„ä»¶ä½¿ç”¨ã€‚

`Lazyload` æ˜¯ `Vue` æŒ‡ä»¤ï¼Œä½¿ç”¨å‰éœ€è¦å¯¹æŒ‡ä»¤è¿›è¡Œæ³¨å†Œã€‚

```js
import { Lazyload } from 'vant'

Vue.use(Lazyload)
```

ç„¶åç»™ Image ç»„ä»¶é…ç½® `lazy-load` æŒ‡ä»¤å±æ€§å¼€å¯æ‡’åŠ è½½

```html
<van-image
  width="100"
  height="100"
  lazy-load
  src="https://img.yzcdn.cn/vant/cat.jpeg"
/>
```

å¦‚æœæ˜¯æ™®é€šçš„ img åˆ™è¿™æ ·ä½¿ç”¨ï¼š

```html
<img v-for="img in imageList" v-lazy="å›¾ç‰‡åœ°å€" >
```

å¦‚æœæ˜¯èƒŒæ™¯å›¾ï¼Œåˆ™è¿™æ ·ä½¿ç”¨ï¼š

> å’Œå›¾ç‰‡æ‡’åŠ è½½ä¸åŒï¼ŒèƒŒæ™¯å›¾æ‡’åŠ è½½éœ€è¦ä½¿ç”¨`v-lazy:background-image`ï¼Œå€¼è®¾ç½®ä¸ºèƒŒæ™¯å›¾ç‰‡çš„åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»å£°æ˜å®¹å™¨é«˜åº¦ã€‚

```html
<div  v-lazy:background-image="å›¾ç‰‡åœ°å€" />
```

æ›´å¤šå†…å®¹è¯·å‚ç…§ï¼š[vue-lazyload å®˜æ–¹æ–‡æ¡£](https://github.com/hilongjw/vue-lazyload)

> æ³¨æ„ï¼šå¦‚æœæµè§ˆå™¨æ§åˆ¶å°å¼€å¯äº† `Disable cache` åŠŸèƒ½ï¼Œåˆ™ä¼šçœ‹åˆ°æ¯ä¸ªå›¾ç‰‡å‡ºç°ä¸¤æ¬¡è¯·æ±‚ï¼Œè¯¥é—®é¢˜å¹¶ä¸å½±å“æœ€ç»ˆç»“æœã€‚

### å¤„ç†ç›¸å¯¹æ—¶é—´

[Day.js](https://day.js.org/zh-CN/) æ˜¯ä¸€ä¸ªè½»é‡çš„å¤„ç†æ—¶é—´å’Œæ—¥æœŸçš„ JavaScript åº“ï¼Œå’Œ [Moment.js](https://momentjs.com/) çš„ API è®¾è®¡ä¿æŒå®Œå…¨ä¸€æ ·ï¼Œå¦‚æœæ‚¨æ›¾ç»ç”¨è¿‡ Moment.js, é‚£ä¹ˆæ‚¨å·²ç»çŸ¥é“å¦‚ä½•ä½¿ç”¨ Day.js ã€‚

- Day.js å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨å’Œ Node.js ä¸­ã€‚

- ğŸ•’ å’Œ Moment.js ç›¸åŒçš„ API å’Œç”¨æ³•
- ğŸ’ª ä¸å¯å˜æ•°æ® (Immutable)
- ğŸ”¥ æ”¯æŒé“¾å¼æ“ä½œ (Chainable)
- ğŸŒ å›½é™…åŒ– I18n
- ğŸ“¦ ä»… 2kb å¤§å°çš„å¾®å‹åº“
- ğŸ‘« å…¨æµè§ˆå™¨å…¼å®¹



1ã€å®‰è£…

```sh
npm i dayjs
```

2ã€åˆ›å»º `utils/dayjs.js`

```js
import Vue from 'vue'
import dayjs from 'dayjs'

// åŠ è½½ä¸­æ–‡è¯­è¨€åŒ…
import 'dayjs/locale/zh-cn'

import relativeTime from 'dayjs/plugin/relativeTime'

// é…ç½®ä½¿ç”¨å¤„ç†ç›¸å¯¹æ—¶é—´çš„æ’ä»¶
dayjs.extend(relativeTime)

// é…ç½®ä½¿ç”¨ä¸­æ–‡è¯­è¨€åŒ…
dayjs.locale('zh-cn')

// å…¨å±€è¿‡æ»¤å™¨ï¼šå¤„ç†ç›¸å¯¹æ—¶é—´
Vue.filter('relativeTime', value => {
  return dayjs().to(dayjs(value))
})

```

3ã€åœ¨ `main.js` ä¸­åŠ è½½åˆå§‹åŒ–

```js
import './utils/dayjs'
```

4ã€ä½¿ç”¨

ä½¿ç”¨è¿‡æ»¤å™¨ï¼š

```html
<p>{{ æ—¥æœŸæ•°æ® | relativeTime }}</p>
```

## ä¼˜åŒ–-ç»„ä»¶ç¼“å­˜

å…ˆæ¥çœ‹ä¸€ä¸ªé—®é¢˜ï¼Ÿ

ä»é¦–é¡µåˆ‡æ¢åˆ°æˆ‘çš„ï¼Œå†ä»æˆ‘çš„å›åˆ°é¦–é¡µï¼Œæˆ‘ä»¬å‘ç°é¦–é¡µé‡æ–°æ¸²æŸ“åŸæ¥çš„çŠ¶æ€æ²¡æœ‰äº†ï¼Œæˆ‘æƒ³è¦æŸäº›é¡µé¢ä¿æŒçŠ¶æ€ï¼Œè€Œä¸ä¼šéšç€è·¯ç”±åˆ‡æ¢å¯¼è‡´é‡æ–°æ¸²æŸ“ã€‚



å¦‚ä½•è§£å†³ï¼Ÿ

- [åœ¨åŠ¨æ€ç»„ä»¶ä¸Šä½¿ç”¨ `keep-alive`](https://cn.vuejs.org/v2/guide/components-dynamic-async.html#åœ¨åŠ¨æ€ç»„ä»¶ä¸Šä½¿ç”¨-keep-alive)



### ä½¿ç”¨ keep-alive ç¼“å­˜ç»„ä»¶

`<keep-alive>` ä¸»è¦ç”¨äºä¿ç•™ç»„ä»¶çŠ¶æ€æˆ–é¿å…é‡æ–°æ¸²æŸ“ï¼Œå½“å®ƒåŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ï¼Œä¼šç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚

ï¼ˆ1ï¼‰`<keep-alive>` æ˜¯ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼šå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“ä¸€ä¸ª DOM å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨ç»„ä»¶çš„çˆ¶ç»„ä»¶é“¾ä¸­ã€‚

ï¼ˆ2ï¼‰`<keep-alive>` è¦æ±‚è¢«åˆ‡æ¢åˆ°çš„ç»„ä»¶éƒ½æœ‰è‡ªå·±çš„åå­—ï¼Œä¸è®ºæ˜¯é€šè¿‡ç»„ä»¶çš„ `name` é€‰é¡¹è¿˜æ˜¯å±€éƒ¨/å…¨å±€æ³¨å†Œã€‚

ï¼ˆ3ï¼‰å½“ç»„ä»¶åœ¨ `<keep-alive>` å†…è¢«åˆ‡æ¢ï¼Œå®ƒçš„ `activated` å’Œ `deactivated` è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å°†ä¼šè¢«å¯¹åº”æ‰§è¡Œã€‚

```js
export default {
  created () {
    console.log('created é¦–æ¬¡æ¸²æŸ“æ—¶æ‰æ‰§è¡Œ')
  },
  mounted () {
    console.log('mounted é¦–æ¬¡æ¸²æŸ“æ—¶æ‰æ‰§è¡Œ')
  },
  
  // æ¸²æŸ“å®Œæˆï¼Œç»„ä»¶ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œä¹‹åä¸å†è§¦å‘ created å’Œ mounted
  
  activated () {
    console.log('å½“ç»„ä»¶ä»ç¼“å­˜ä¸­è¢«æ¿€æ´»æ—¶è§¦å‘è°ƒç”¨')
  },
  deactivated () {
    console.log('å½“ç»„ä»¶ä»ç¼“å­˜ä¸­å¤±å»æ´»åŠ¨æ—¶è§¦å‘è°ƒç”¨')
  }
}
```

ï¼ˆ4ï¼‰ç»„ä»¶ç¼“å­˜åªæ˜¯åœ¨åº”ç”¨è¿è¡ŒæœŸé—´ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œå¦‚æœé¡µé¢åˆ·æ–°è¿˜æ˜¯ä¼šå›åˆ°åˆå§‹çŠ¶æ€ã€‚

ï¼ˆ5ï¼‰`include` å’Œ `exclude` å±æ€§å…è®¸ç»„ä»¶æœ‰æ¡ä»¶åœ°ç¼“å­˜ã€‚äºŒè€…éƒ½å¯ä»¥ç”¨é€—å·åˆ†éš”å­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼æˆ–ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºã€‚

```html
<!-- é€—å·åˆ†éš”å­—ç¬¦ä¸² -->
<keep-alive include="a,b">
  <component :is="view"></component>
</keep-alive>

<!-- æ­£åˆ™è¡¨è¾¾å¼ (ä½¿ç”¨ `v-bind`) -->
<keep-alive :include="/a|b/">
  <component :is="view"></component>
</keep-alive>

<!-- æ•°ç»„ (ä½¿ç”¨ `v-bind`) -->
<keep-alive :include="['a', 'b']">
  <component :is="view"></component>
</keep-alive>
```

åŒ¹é…é¦–å…ˆæ£€æŸ¥ç»„ä»¶è‡ªèº«çš„ `name` é€‰é¡¹ï¼Œå¦‚æœ `name` é€‰é¡¹ä¸å¯ç”¨ï¼Œåˆ™åŒ¹é…å®ƒçš„å±€éƒ¨æ³¨å†Œåç§° (çˆ¶ç»„ä»¶ `components` é€‰é¡¹çš„é”®å€¼)ã€‚åŒ¿åç»„ä»¶ä¸èƒ½è¢«åŒ¹é…ã€‚

> å‚è€ƒé˜…è¯»
>
> - [åœ¨åŠ¨æ€ç»„ä»¶ä¸Šä½¿ç”¨ keep-alive](https://cn.vuejs.org/v2/guide/components-dynamic-async.html#åœ¨åŠ¨æ€ç»„ä»¶ä¸Šä½¿ç”¨-keep-alive)
> - [å†…ç½®çš„ç»„ä»¶ keep-alive](https://cn.vuejs.org/v2/api/#keep-alive)

### é¡¹ç›®ä¸­çš„ç¼“å­˜é…ç½®

1ã€åœ¨ `App.vue` å¯¹æ ¹è·¯ç”±ç»„ä»¶å¯ç”¨ç»„ä»¶ç¼“å­˜

```html
<template>
  <div id="app">
    <!--
      ä¸€çº§è·¯ç”±å‡ºå£
      ç¼“å­˜ä¸€çº§è·¯ç”±ç»„ä»¶
    -->
    <keep-alive :include="cachePages">
      <router-view />
    </keep-alive>
  </div>
</template>

<script>
export default {
  name: 'App',
  data () {
    return {
      cachePages: ['TabBar']
    }
  }
}
</script>

<style lang="less"></style>

```

2ã€åœ¨ `views/tabbar/index.vue` å¯¹å­è·¯ç”±ä¹Ÿå¯ç”¨ç»„ä»¶ç¼“å­˜

```html
<keep-alive>
  <router-view />
</keep-alive>
```



### è§£å†³é¡¹ç›®ä¸­ç»„ä»¶ç¼“å­˜å¸¦æ¥çš„é—®é¢˜

ä¸€ã€é¦–é¡µæ–‡ç« åˆ—è¡¨æ»šåŠ¨ä½ç½®

```js
activated () {
  this.onTabChange()
},
methods: {
  onTabChange () {
    const activeChannel = this.channels[this.active]
    if (!activeChannel) {
      return
    }
    const scrollTop = activeChannel.scrollTop
    if (scrollTop) {
      this.$nextTick(() => {
        this.articleScrollWrap.scrollTop = scrollTop
      })
      // this.articleScrollWrap.scrollTop = scrollTop
    }
  }
}
```



äºŒã€ç™»å½•æˆåŠŸï¼Œæˆ‘çš„é¡µé¢æ•°æ®ä¸æ›´æ–°é—®é¢˜

```js
created () {
  // if (this.$store.state.user) {
  //   this.loadUser()
  // }
},
mounted () {},
activated () {
  if (this.$store.state.user) {
    this.loadUser()
  }
},
```



## æ€»ç»“

